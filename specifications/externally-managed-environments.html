<!doctype html>
<html class="no-js" lang="zh-CN" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="索引" href="../genindex.html" /><link rel="search" title="搜索" href="../search.html" /><link rel="next" title="包分发文件格式" href="section-distribution-formats.html" /><link rel="prev" title="Python 虚拟环境" href="virtual-environments.html" />

    <link rel="shortcut icon" href="../_static/py.png"/><!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>外部管理环境 - Python Packaging User Guide</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Python Packaging User Guide</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">Python Packaging User Guide</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="搜索" name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">概述</a></li>
<li class="toctree-l1"><a class="reference internal" href="../flow.html">打包流程</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorials/index.html">教程</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of 教程</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/installing-packages.html">安装软件包</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/managing-dependencies.html">管理依赖项</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/packaging-projects.html">打包Python项目</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../guides/index.html">指南</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of 指南</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../guides/section-install.html">安装</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of 安装</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../guides/installing-using-pip-and-virtual-environments.html">使用 pip 和 venv 在虚拟环境中安装软件包</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/installing-using-virtualenv.html">使用虚拟环境安装包</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/installing-stand-alone-command-line-tools.html">安装独立的命令行工具</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/installing-using-linux-tools.html">使用 Linux 包管理器安装 pip/setuptools/wheel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/installing-scientific-packages.html">安装科学软件包</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../guides/section-build-and-publish.html">构建和发布</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of 构建和发布</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../guides/writing-pyproject-toml.html">编写你的 <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/distributing-packages-using-setuptools.html">打包和分发项目</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/dropping-older-python-versions.html">放弃对旧版 Python 的支持</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/packaging-binary-extensions.html">打包二进制扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/packaging-namespace-packages.html">打包命名空间包</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/creating-command-line-tools.html">创建和打包命令行工具</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/creating-and-discovering-plugins.html">创建和发现插件</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/using-testpypi.html">使用 TestPyPI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/making-a-pypi-friendly-readme.html">制作适合 PyPI 的 README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/publishing-package-distribution-releases-using-github-actions-ci-cd-workflows.html">使用 GitHub Actions CI/CD 工作流发布软件包分发版本</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/modernize-setup-py-project.html">如何使基于 <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> 的项目现代化？</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../guides/section-hosting.html">托管</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of 托管</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../guides/index-mirrors-and-caches.html">包索引镜像和缓存</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/hosting-your-own-index.html">托管您自己的简单存储库</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../guides/tool-recommendations.html">工具推荐</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/analyzing-pypi-package-downloads.html">分析 PyPI 软件包下载</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../discussions/index.html">讨论</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of 讨论</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../discussions/versioning.html">版本控制</a></li>
<li class="toctree-l2"><a class="reference internal" href="../discussions/deploying-python-applications.html">部署 Python 应用程序</a></li>
<li class="toctree-l2"><a class="reference internal" href="../discussions/pip-vs-easy-install.html">pip vs easy_install</a></li>
<li class="toctree-l2"><a class="reference internal" href="../discussions/install-requires-vs-requirements.html">install_requires 与需求文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../discussions/distribution-package-vs-import-package.html">分发包与导入包</a></li>
<li class="toctree-l2"><a class="reference internal" href="../discussions/package-formats.html">软件包格式</a></li>
<li class="toctree-l2"><a class="reference internal" href="../discussions/src-layout-vs-flat-layout.html">src 布局与平面布局</a></li>
<li class="toctree-l2"><a class="reference internal" href="../discussions/setup-py-deprecated.html"><code class="docutils literal notranslate"><span class="pre">setup.py</span></code> 已被弃用吗？</a></li>
<li class="toctree-l2"><a class="reference internal" href="../discussions/single-source-version.html">单一来源项目版本</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">PyPA 规范</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of PyPA 规范</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="section-distribution-metadata.html">包分发元数据</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of 包分发元数据</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="name-normalization.html">名称和规范化</a></li>
<li class="toctree-l3"><a class="reference internal" href="core-metadata.html">核心元数据规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="version-specifiers.html">版本标识符</a></li>
<li class="toctree-l3"><a class="reference internal" href="dependency-specifiers.html">依赖说明符</a></li>
<li class="toctree-l3"><a class="reference internal" href="pyproject-toml.html"><code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> 规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="inline-script-metadata.html">内联脚本元数据</a></li>
<li class="toctree-l3"><a class="reference internal" href="platform-compatibility-tags.html">平台兼容性标签</a></li>
<li class="toctree-l3"><a class="reference internal" href="well-known-project-urls.html">元数据中的知名项目 URL</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="section-installation-metadata.html">包安装元数据</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of 包安装元数据</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="recording-installed-packages.html">记录已安装的项目</a></li>
<li class="toctree-l3"><a class="reference internal" href="entry-points.html">入口点规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="direct-url.html">记录已安装发行版的直接 URL 来源</a></li>
<li class="toctree-l3"><a class="reference internal" href="direct-url-data-structure.html">直接 URL 数据结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="virtual-environments.html">Python 虚拟环境</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">外部管理环境</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="section-distribution-formats.html">包分发文件格式</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of 包分发文件格式</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="source-distribution-format.html">源分发格式</a></li>
<li class="toctree-l3"><a class="reference internal" href="binary-distribution-format.html">二进制分发格式</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="section-package-indices.html">包索引接口</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of 包索引接口</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="pypirc.html"><code class="file docutils literal notranslate"><span class="pre">.pypirc</span></code> 文件</a></li>
<li class="toctree-l3"><a class="reference internal" href="simple-repository-api.html">Simple 仓库 API</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../key_projects.html">项目摘要</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">术语</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support.html">如何获取支持</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute.html">为本指南做出贡献</a></li>
<li class="toctree-l1"><a class="reference internal" href="../news.html">新闻</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/specifications/externally-managed-environments.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="externally-managed-environments">
<span id="id1"></span><h1>外部管理环境<a class="headerlink" href="#externally-managed-environments" title="Link to this heading">¶</a></h1>
<p><strong>Externally Managed Environments</strong></p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--0-input--1" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--1">中文</label><div class="tab-content docutils container">
<p>尽管有些 Python 安装完全由安装 Python 的用户管理，但也有一些可能是由其他方式提供和管理的（例如，在 Linux 发行版中的操作系统包管理器，或作为应用程序中带有专用安装程序的捆绑 Python 环境）。</p>
<p>尝试使用常规的 Python 打包工具来操作此类环境，最好的情况可能会令人困惑，最坏的情况甚至可能会彻底破坏底层操作系统。文档和互操作性指南只能在一定程度上解决这些问题。</p>
<p>本规范定义了一个 <code class="docutils literal notranslate"><span class="pre">EXTERNALLY-MANAGED</span></code> 标记文件，允许 Python 安装向像 <code class="docutils literal notranslate"><span class="pre">pip</span></code> 这样的 Python 特定工具指示，它们既不安装也不移除包到解释器的默认安装环境中，而应该引导最终用户使用 <a class="reference internal" href="virtual-environments.html#virtual-environments"><span class="std std-ref">Python 虚拟环境</span></a>。</p>
<p>它还标准化了解释 <code class="docutils literal notranslate"><span class="pre">sysconfig</span></code> 安装方案的方式，以便在 Python 特定的包管理器即将安装包到解释器级别的上下文中时，可以以避免与外部包管理器冲突的方式进行操作，并减少破坏外部包管理器所提供软件的风险。</p>
</div>
<input class="tab-input" id="tab-set--0-input--2" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--2">英文</label><div class="tab-content docutils container">
<p>While some Python installations are entirely managed by the user that installed
Python, others may be provided and managed by another means (such as the
operating system package manager in a Linux distribution, or as a bundled
Python environment in an application with a dedicated installer).</p>
<p>Attempting to use conventional Python packaging tools to manipulate such
environments can be confusing at best and outright break the entire underlying
operating system at worst. Documentation and interoperability guides only go
so far in resolving such problems.</p>
<p>This specification defines an <code class="docutils literal notranslate"><span class="pre">EXTERNALLY-MANAGED</span></code> marker file that allows a
Python installation to indicate to Python-specific tools such as <code class="docutils literal notranslate"><span class="pre">pip</span></code> that they
neither install nor remove packages into the interpreter’s default installation
environment, and should instead guide the end user towards using
<a class="reference internal" href="virtual-environments.html#virtual-environments"><span class="std std-ref">Python 虚拟环境</span></a>.</p>
<p>It also standardizes an interpretation of the <code class="docutils literal notranslate"><span class="pre">sysconfig</span></code> schemes so
that, if a Python-specific package manager is about to install a
package in an interpreter-wide context, it can do so in a manner that
will avoid conflicting with the external package manager and reduces
the risk of breaking software shipped by the external package manager.</p>
</div>
</div>
<section id="id2">
<h2>术语<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<p><strong>Terminology</strong></p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--1-input--1" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--1">中文</label><div class="tab-content docutils container">
<p>本规范中使用的一些术语在其涵盖的不同上下文中有多个含义。为确保清晰，本规范对以下术语进行了特定的定义：</p>
<dl>
<dt>distro</dt><dd><p>&quot;distribution&quot;（分发版）的缩写，是指一种包含各种软件的集合，理想情况下这些软件能够正确地协同工作，包括（在本文件相关上下文中）Python 解释器本身，使用 Python 编写的软件，以及使用其他语言编写的软件。也就是说，这与 &quot;Linux distro&quot;（Linux 发行版）或 &quot;Berkeley Software Distribution&quot;（伯克利软件分发版）这样的短语中的意思相同。</p>
<p>一个发行版可以是一个独立的操作系统（OS），例如 Debian、Fedora 或 FreeBSD。它也可以是一个安装在现有操作系统之上的覆盖发行版，例如 Homebrew 或 MacPorts。</p>
<p>本文件使用缩写 &quot;distro&quot;，因为在 Python 打包的上下文中，&quot;distribution&quot; 另有含义，指的是单个 Python 软件包的源代码或二进制分发包，也就是指 <code class="docutils literal notranslate"><span class="pre">setuptools.dist.Distribution</span></code> 或 &quot;sdist&quot; 的意思。为避免混淆，本文件不使用 &quot;distribution&quot; 一词，而是使用 &quot;distribution package&quot; 或简称 &quot;package&quot;（见下文）。</p>
<p>一个发行版的提供者 —— 即收集和发布软件并做出必要修改的团队或公司 —— 称为 <strong>distributor</strong> （分发者）。</p>
</dd>
<dt>package</dt><dd><p>一个可以在 Python 中安装并使用的软件单元。也就是说，这指的是 Python 特定的打包工具所称的 <a class="reference internal" href="../glossary.html#term-Distribution-Package"><span class="xref std std-term">distribution package</span></a> 或简写为 &quot;distribution&quot;；在 Python 包索引（PyPI）中，&quot;package&quot; 被用作通俗的缩写。</p>
<p>本文件中不会将 &quot;package&quot; 用来指代可导入的 Python 模块包，尽管在许多情况下，一个分发包可能由一个单一的可导入包组成，并且两者同名。</p>
<p>本文件一般不会使用 &quot;package&quot; 来指代发行版包管理器（如 <code class="docutils literal notranslate"><span class="pre">.deb</span></code> 或 <code class="docutils literal notranslate"><span class="pre">.rpm</span></code> 文件）安装的单元。当需要时，会使用诸如 &quot;a distro's package&quot;（发行版的包）之类的措辞。（同样，许多情况下，Python 包会作为类似 <code class="docutils literal notranslate"><span class="pre">python-</span></code> 后缀的发行版包的一部分进行分发。）</p>
</dd>
<dt>Python-specific package manager</dt><dd><p>用于安装、升级和/或移除符合 Python 打包标准的 Python 包的工具。最流行的 Python 特定包管理器是 <a class="reference external" href="https://pip.pypa.io/en/stable/">pip</a>，其他例子包括旧版的 <a class="reference external" href="https://setuptools.readthedocs.io/en/latest/deprecated/easy_install.html">Easy Install 命令</a> 以及直接使用 <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> 命令。</p>
<p>（注意，<code class="docutils literal notranslate"><span class="pre">easy_install</span></code> 命令已从 2021 年 1 月 23 日发布的 setuptools 版本 52 中移除。）</p>
<p>（<a class="reference external" href="https://conda.io">Conda</a> 是一个特殊的案例，因为 <code class="docutils literal notranslate"><span class="pre">conda</span></code> 命令不仅能安装 Python 包，还能安装其他软件包，因此在某些情况下，它更像是一个发行版包管理器。由于 <code class="docutils literal notranslate"><span class="pre">conda</span></code> 命令通常仅在 Conda 创建的环境中运行，因此本文件中的大多数问题不适用于 <code class="docutils literal notranslate"><span class="pre">conda</span></code>，当其作为 Python 特定的包管理器时。）</p>
</dd>
<dt>distro package manager</dt><dd><p>用于在已安装的发行版实例中安装、升级和/或移除发行版包的工具，该工具能够安装 Python 包和非 Python 包，并因此通常有自己独立的已安装软件数据库，与 <a class="reference internal" href="recording-installed-packages.html#recording-installed-packages"><span class="std std-ref">记录已安装的项目</span></a> 中的已安装分发包数据库无关。例子包括 <code class="docutils literal notranslate"><span class="pre">apt</span></code>、<code class="docutils literal notranslate"><span class="pre">dpkg</span></code>、<code class="docutils literal notranslate"><span class="pre">dnf</span></code>、<code class="docutils literal notranslate"><span class="pre">rpm</span></code>、<code class="docutils literal notranslate"><span class="pre">pacman</span></code> 和 <code class="docutils literal notranslate"><span class="pre">brew</span></code>。关键特性是，如果某个包是由发行版包管理器安装的，那么以 Python 特定的包管理器方式移除或升级它，通常会使发行版包管理器处于不一致状态。</p>
<p>本文件也使用诸如 &quot;external package manager&quot;（外部包管理器）或 &quot;system's package manager&quot;（系统包管理器）这样的短语来指代发行版包管理器。</p>
</dd>
<dt>shadow</dt><dd><p>&quot;shadow&quot; 已安装的 Python 包是指使另一个包在导入时被优先使用，而不移除任何来自被遮蔽包的文件。这需要在 <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> 上有多个条目：例如，如果 A 2.0 包将模块 <code class="docutils literal notranslate"><span class="pre">a.py</span></code> 安装在某个 <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> 条目中，而 A 1.0 包将模块 <code class="docutils literal notranslate"><span class="pre">a.py</span></code> 安装在后面的条目中，那么 <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">a</span></code> 会返回来自 A 2.0 的模块，我们称 A 2.0 遮蔽了 A 1.0。</p>
</dd>
</dl>
</div>
<input class="tab-input" id="tab-set--1-input--2" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--2">英文</label><div class="tab-content docutils container">
<p>A few terms used in this specification have multiple meanings in the
contexts that it spans. For clarity, this specification uses the following
terms in specific ways:</p>
<dl>
<dt>distro</dt><dd><p>Short for &quot;distribution,&quot; a collection of various sorts of
software, ideally designed to work properly together, including
(in contexts relevant to this document) the Python interpreter
itself, software written in Python, and software written in other
languages. That is, this is the sense used in phrases such as
&quot;Linux distro&quot; or &quot;Berkeley Software Distribution.&quot;</p>
<p>A distro can be an operating system (OS) of its own, such as
Debian, Fedora, or FreeBSD. It can also be an overlay distribution
that installs on top of an existing OS, such as Homebrew or
MacPorts.</p>
<p>This document uses the short term &quot;distro,&quot; because the term
&quot;distribution&quot; has another meaning in Python packaging contexts: a
source or binary distribution package of a single piece of Python
language software, that is, in the sense of
<code class="docutils literal notranslate"><span class="pre">setuptools.dist.Distribution</span></code> or &quot;sdist&quot;. To avoid confusion,
this document does not use the plain term &quot;distribution&quot; at all.
In the Python packaging sense, it uses the full phrase
&quot;distribution package&quot; or just &quot;package&quot; (see below).</p>
<p>The provider of a distro - the team or company that collects and
publishes the software and makes any needed modifications - is its
<strong>distributor</strong>.</p>
</dd>
<dt>package</dt><dd><p>A unit of software that can be installed and used within Python.
That is, this refers to what Python-specific packaging tools tend
to call a <a class="reference internal" href="../glossary.html#term-Distribution-Package"><span class="xref std std-term">distribution package</span></a> or simply a &quot;distribution&quot;;
the colloquial abbreviation &quot;package&quot; is used in the sense of the
Python Package Index.</p>
<p>This document does not use &quot;package&quot; in the sense of an importable
name that contains Python modules, though in many cases, a
distribution package consists of a single importable package of
the same name.</p>
<p>This document generally does not use the term &quot;package&quot; to refer
to units of installation by a distro's package manager (such as
<code class="docutils literal notranslate"><span class="pre">.deb</span></code> or <code class="docutils literal notranslate"><span class="pre">.rpm</span></code> files). When needed, it uses phrasing such as
&quot;a distro's package.&quot; (Again, in many cases, a Python package is
shipped inside a distro's package named something like <code class="docutils literal notranslate"><span class="pre">python-</span></code>
plus the Python package name.)</p>
</dd>
<dt>Python-specific package manager</dt><dd><p>A tool for installing, upgrading, and/or removing Python packages
in a manner that conforms to Python packaging standards.
The most popular Python-specific package
manager is <a class="reference external" href="https://pip.pypa.io/en/stable/">pip</a>; other examples include the old <a class="reference external" href="https://setuptools.readthedocs.io/en/latest/deprecated/easy_install.html">Easy
Install command</a> as well as direct usage of a
<code class="docutils literal notranslate"><span class="pre">setup.py</span></code> command.</p>
<p>(Note that the <code class="docutils literal notranslate"><span class="pre">easy_install</span></code> command was removed in
setuptools version 52, released 23 January 2021.)</p>
<p>(<a class="reference external" href="https://conda.io">Conda</a> is a bit of a special case, as the <code class="docutils literal notranslate"><span class="pre">conda</span></code>
command can install much more than just Python packages, making it
more like a distro package manager in some senses. Since the
<code class="docutils literal notranslate"><span class="pre">conda</span></code> command generally only operates on Conda-created
environments, most of the concerns in this document do not apply
to <code class="docutils literal notranslate"><span class="pre">conda</span></code> when acting as a Python-specific package manager.)</p>
</dd>
<dt>distro package manager</dt><dd><p>A tool for installing, upgrading, and/or removing a distro's
packages in an installed instance of that distro, which is capable
of installing Python packages as well as non-Python packages, and
therefore generally has its own database of installed software
unrelated to the <a class="reference internal" href="recording-installed-packages.html#recording-installed-packages"><span class="std std-ref">database of installed distributions</span></a>. Examples include <code class="docutils literal notranslate"><span class="pre">apt</span></code>, <code class="docutils literal notranslate"><span class="pre">dpkg</span></code>,
<code class="docutils literal notranslate"><span class="pre">dnf</span></code>, <code class="docutils literal notranslate"><span class="pre">rpm</span></code>, <code class="docutils literal notranslate"><span class="pre">pacman</span></code>, and <code class="docutils literal notranslate"><span class="pre">brew</span></code>. The salient feature is
that if a package was installed by a distro package manager, removing or
upgrading it in a way that would satisfy a Python-specific package
manager will generally leave a distro package manager in an
inconsistent state.</p>
<p>This document also uses phrases like &quot;external package manager&quot; or
&quot;system's package manager&quot; to refer to a distro package manager in
certain contexts.</p>
</dd>
<dt>shadow</dt><dd><p>To shadow an installed Python package is to cause some other
package to be preferred for imports without removing any files
from the shadowed package. This requires multiple entries on
<code class="docutils literal notranslate"><span class="pre">sys.path</span></code>: if package A 2.0 installs module <code class="docutils literal notranslate"><span class="pre">a.py</span></code> in one
<code class="docutils literal notranslate"><span class="pre">sys.path</span></code> entry, and package A 1.0 installs module <code class="docutils literal notranslate"><span class="pre">a.py</span></code> in
a later <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> entry, then <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">a</span></code> returns the module
from the former, and we say that A 2.0 shadows A 1.0.</p>
</dd>
</dl>
</div>
</div>
</section>
<section id="id3">
<h2>概述<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h2>
<p><strong>Overview</strong></p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--2-input--1" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--1">中文</label><div class="tab-content docutils container">
<p>本规范有两个方面。</p>
<p>首先，它描述了 <strong>一种标记 Python 解释器的方式，用于表明该解释器的包由 Python 之外的方式进行管理</strong>，以便 Python 特定的工具（如 pip）在未明确覆盖的情况下，不应以任何方式（添加、升级/降级或移除）更改解释器的全局 <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> 中安装的包。同时，它还提供了一种方式供发行版提供者指示如何使用虚拟环境作为替代方案。</p>
<p>这是一个选择性机制：默认情况下，从上游源代码编译的 Python 解释器不会被标记，因此在使用自编译的解释器或未明确标记其解释器的发行版时，运行 <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code> 将照常工作。</p>
<p>其次，它设定了一个规则：当向解释器的全局上下文安装包时（无论是向未标记的解释器安装，还是覆盖标记），<strong>Python 特定的包管理器应仅在它们会创建文件的 sysconfig 方案中的目录内修改或删除文件</strong>。这使得 Python 解释器的发行者能够设置两个目录，一个用于其管理的包，一个用于最终用户安装的未管理包，并确保安装未管理的包时不会删除（或覆盖）外部包管理器所拥有的文件。</p>
</div>
<input class="tab-input" id="tab-set--2-input--2" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--2">英文</label><div class="tab-content docutils container">
<p>This specification is twofold.</p>
<p>First, it describes <strong>a way for distributors of a Python interpreter to
mark that interpreter as having its packages managed by means external
to Python</strong>, such that Python-specific tools like pip should not
change the installed packages in the interpreter's global <code class="docutils literal notranslate"><span class="pre">sys.path</span></code>
in any way (add, upgrade/downgrade, or remove) unless specifically
overridden. It also provides a means for the distributor to indicate
how to use a virtual environment as an alternative.</p>
<p>This is an opt-in mechanism: by default, the Python interpreter
compiled from upstream sources will not be so marked, and so running
<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code> with a self-compiled interpreter, or with a distro
that has not explicitly marked its interpreter, will work as it always
has worked.</p>
<p>Second, it sets the rule that when installing packages to an
interpreter's global context (either to an unmarked interpreter, or if
overriding the marking), <strong>Python-specific package managers should
modify or delete files only within the directories of the sysconfig
scheme in which they would create files</strong>. This permits a distributor
of a Python interpreter to set up two directories, one for its own
managed packages, and one for unmanaged packages installed by the end
user, and ensure that installing unmanaged packages will not delete
(or overwrite) files owned by the external package manager.</p>
</div>
</div>
</section>
<section id="id4">
<h2>将解释器标记为使用外部包管理器<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h2>
<p><strong>Marking an interpreter as using an external package manager</strong></p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--3-input--1" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--1">中文</label><div class="tab-content docutils container">
<p>在安装 Python 特定包的工具（例如 pip，而非外部工具如 apt）向某个 Python 环境中安装包之前，默认情况下，它应进行以下检查：</p>
<ol class="arabic simple">
<li><p>是否在虚拟环境之外运行？可以通过检查 <code class="docutils literal notranslate"><span class="pre">sys.prefix</span> <span class="pre">==</span> <span class="pre">sys.base_prefix</span></code> 来判断。</p></li>
<li><p>在由 <code class="docutils literal notranslate"><span class="pre">sysconfig.get_path(&quot;stdlib&quot;,</span> <span class="pre">sysconfig.get_default_scheme())</span></code> 指定的目录中是否存在 <code class="docutils literal notranslate"><span class="pre">EXTERNALLY-MANAGED</span></code> 文件？</p></li>
</ol>
<p>如果这两个条件都成立，安装器应退出并显示一条错误消息，指示在虚拟环境之外不允许向该 Python 解释器的目录中安装包。</p>
<p>安装器应允许用户覆盖这些规则，例如通过命令行选项 <code class="docutils literal notranslate"><span class="pre">--break-system-packages</span></code>。该选项默认不启用，并且应有一定的风险提示。</p>
<p><code class="docutils literal notranslate"><span class="pre">EXTERNALLY-MANAGED</span></code> 文件是一个 INI 风格的元数据文件，旨在通过标准库中的 <a class="reference external" href="https://docs.python.org/3/library/configparser.html">configparser</a> 模块进行解析。如果该文件可以通过 <code class="docutils literal notranslate"><span class="pre">configparser.ConfigParser(interpolation=None)</span></code> 以 UTF-8 编码进行解析，并且文件中包含 <code class="docutils literal notranslate"><span class="pre">[externally-managed]</span></code> 节，则安装器应查找文件中指定的错误消息，并将其作为错误的一部分输出。如果返回的元组的第一个元素（即语言代码）不是 <code class="docutils literal notranslate"><span class="pre">None</span></code>，则应查找以 <code class="docutils literal notranslate"><span class="pre">Error-</span></code> 后跟语言代码的键。如果该键不存在，并且语言代码中包含下划线或连字符，则应查找以 <code class="docutils literal notranslate"><span class="pre">Error-</span></code> 后跟语言代码中下划线或连字符之前的部分的键。如果找不到这些键，或者语言代码为 <code class="docutils literal notranslate"><span class="pre">None</span></code>，则应查找一个名为 <code class="docutils literal notranslate"><span class="pre">Error</span></code> 的键。</p>
<p>如果安装器在文件中找不到错误消息（因为文件无法解析或没有找到合适的错误键），则应使用预定义的错误消息，建议用户创建一个虚拟环境以安装包。</p>
<p>那些使用非 Python 特定包管理器（管理其 Python 包中 <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> 中的库的包管理器）的软件发行商，通常应在其标准库目录中提供一个 <code class="docutils literal notranslate"><span class="pre">EXTERNALLY-MANAGED</span></code> 文件。例如，Debian 可能会在 <code class="docutils literal notranslate"><span class="pre">/usr/lib/python3.9/EXTERNALLY-MANAGED</span></code> 中提供一个类似如下内容的文件：</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[externally-managed]</span>
<span class="na">Error</span><span class="o">=</span><span class="s">要在系统范围内安装 Python 包，请尝试使用 apt 安装</span>
<span class="na">python3-xyz，其中 xyz 是您尝试安装的包。</span>

<span class="na">如果您希望安装非 Debian 打包的 Python 包，</span>
<span class="na">请使用 python3 -m venv path/to/venv 创建虚拟环境。</span>
<span class="na">然后使用 path/to/venv/bin/python 和 path/to/venv/bin/pip。确保安装了 python3-full。</span>

<span class="na">如果您希望安装非 Debian 打包的 Python 应用程序，</span>
<span class="na">使用 pipx install xyz 可能是最简单的方法，它会为您管理虚拟环境。确保安装了 pipx。</span>

<span class="na">更多信息请参阅 /usr/share/doc/python3.9/README.venv。</span>
</pre></div>
</div>
<p>该文件为尝试安装包的用户提供了有用的、与发行版相关的信息。可选地，翻译也可以包含在同一文件中：</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="na">Error-de_DE</span><span class="o">=</span><span class="s">Wenn ist das Nunstück git und Slotermeyer?</span>

<span class="na">Ja! Beiherhund das Oder die Virtualenvironment gersput!</span>
</pre></div>
</div>
<p>在某些上下文中，如单一应用程序容器镜像（在创建后不会更新），发行版可能选择不提供 <code class="docutils literal notranslate"><span class="pre">EXTERNALLY-MANAGED</span></code> 文件，以便用户可以按照现在的方式安装任何他们喜欢的包，而无需手动覆盖该规则。</p>
</div>
<input class="tab-input" id="tab-set--3-input--2" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--2">英文</label><div class="tab-content docutils container">
<p>Before a Python-specific package installer (that is, a tool such as
pip - not an external tool such as apt) installs a package into a
certain Python context, it should make the following checks by
default:</p>
<ol class="arabic simple">
<li><p>Is it running outside of a virtual environment? It can determine
this by whether <code class="docutils literal notranslate"><span class="pre">sys.prefix</span> <span class="pre">==</span> <span class="pre">sys.base_prefix</span></code>.</p></li>
<li><p>Is there an <code class="docutils literal notranslate"><span class="pre">EXTERNALLY-MANAGED</span></code> file in the directory identified
by <code class="docutils literal notranslate"><span class="pre">sysconfig.get_path(&quot;stdlib&quot;,</span> <span class="pre">sysconfig.get_default_scheme())</span></code>?</p></li>
</ol>
<p>If both of these conditions are true, the installer should exit with
an error message indicating that package installation into this Python
interpreter's directory are disabled outside of a virtual environment.</p>
<p>The installer should have a way for the user to override these rules,
such as a command-line flag <code class="docutils literal notranslate"><span class="pre">--break-system-packages</span></code>. This option
should not be enabled by default and should carry some connotation
that its use is risky.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">EXTERNALLY-MANAGED</span></code> file is an INI-style metadata file intended
to be parsable by the standard library <a class="reference external" href="https://docs.python.org/3/library/configparser.html">configparser</a> module. If the
file can be parsed by
<code class="docutils literal notranslate"><span class="pre">configparser.ConfigParser(interpolation=None)</span></code> using the UTF-8
encoding, and it contains a section <code class="docutils literal notranslate"><span class="pre">[externally-managed]</span></code>, then the
installer should look for an error message specified in the file and
output it as part of its error. If the first element of the tuple
returned by <code class="docutils literal notranslate"><span class="pre">locale.getlocale(locale.LC_MESSAGES)</span></code>, i.e., the
language code, is not <code class="docutils literal notranslate"><span class="pre">None</span></code>, it should look for the error message
as the value of a key named <code class="docutils literal notranslate"><span class="pre">Error-</span></code> followed by the language code.
If that key does not exist, and if the language code contains
underscore or hyphen, it should look for a key named <code class="docutils literal notranslate"><span class="pre">Error-</span></code>
followed by the portion of the language code before the underscore or
hyphen. If it cannot find either of those, or if the language code is
<code class="docutils literal notranslate"><span class="pre">None</span></code>, it should look for a key simply named <code class="docutils literal notranslate"><span class="pre">Error</span></code>.</p>
<p>If the installer cannot find an error message in the file (either
because the file cannot be parsed or because no suitable error key
exists), then the installer should just use a pre-defined error
message of its own, which should suggest that the user create a
virtual environment to install packages.</p>
<p>Software distributors who have a non-Python-specific package manager
that manages libraries in the <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> of their Python package
should, in general, ship an <code class="docutils literal notranslate"><span class="pre">EXTERNALLY-MANAGED</span></code> file in their
standard library directory. For instance, Debian may ship a file in
<code class="docutils literal notranslate"><span class="pre">/usr/lib/python3.9/EXTERNALLY-MANAGED</span></code> consisting of something like</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[externally-managed]</span>
<span class="na">Error</span><span class="o">=</span><span class="s">To install Python packages system-wide, try apt install</span>
<span class="na">python3-xyz, where xyz is the package you are trying to</span>
<span class="na">install.</span>

<span class="na">If you wish to install a non-Debian-packaged Python package,</span>
<span class="na">create a virtual environment using python3 -m venv path/to/venv.</span>
<span class="na">Then use path/to/venv/bin/python and path/to/venv/bin/pip. Make</span>
<span class="na">sure you have python3-full installed.</span>

<span class="na">If you wish to install a non-Debian packaged Python application,</span>
<span class="na">it may be easiest to use pipx install xyz, which will manage a</span>
<span class="na">virtual environment for you. Make sure you have pipx installed.</span>

<span class="na">See /usr/share/doc/python3.9/README.venv for more information.</span>
</pre></div>
</div>
<p>which provides useful and distro-relevant information
to a user trying to install a package. Optionally,
translations can be provided in the same file:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="na">Error-de_DE</span><span class="o">=</span><span class="s">Wenn ist das Nunstück git und Slotermeyer?</span>

<span class="na">Ja! Beiherhund das Oder die Virtualenvironment gersput!</span>
</pre></div>
</div>
<p>In certain contexts, such as single-application container images that
aren't updated after creation, a distributor may choose not to ship an
<code class="docutils literal notranslate"><span class="pre">EXTERNALLY-MANAGED</span></code> file, so that users can install whatever they
like (as they can today) without having to manually override this
rule.</p>
</div>
</div>
</section>
<section id="sysconfig">
<h2>仅写入目标“sysconfig”方案<a class="headerlink" href="#sysconfig" title="Link to this heading">¶</a></h2>
<p><strong>Writing to only the target ``sysconfig`` scheme</strong></p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--4-input--1" name="tab-set--4" type="radio"><label class="tab-label" for="tab-set--4-input--1">中文</label><div class="tab-content docutils container">
<p>通常，Python 包安装器会将包安装到 <code class="docutils literal notranslate"><span class="pre">sysconfig</span></code> 标准库包返回的目录中。通常，这是由 <code class="docutils literal notranslate"><span class="pre">sysconfig.get_default_scheme()</span></code> 返回的方案，但根据配置（例如 <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--user</span></code>），它可能会使用不同的方案。</p>
<p>每当安装器向 <code class="docutils literal notranslate"><span class="pre">sysconfig</span></code> 方案安装时，本规范声明安装器不应修改或删除该方案以外的文件。例如，如果它正在升级一个包，而该包已经安装在该方案之外的某个目录（可能是另一个方案中的目录），则应保持现有文件不变。</p>
<p>如果安装器在升级过程中确实覆盖了现有的安装，我们建议它在运行结束时产生警告。</p>
<p>如果安装器正在向 <code class="docutils literal notranslate"><span class="pre">sysconfig</span></code> 方案之外的目录安装（例如， <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--target</span></code> ），则本小节不适用。</p>
</div>
<input class="tab-input" id="tab-set--4-input--2" name="tab-set--4" type="radio"><label class="tab-label" for="tab-set--4-input--2">英文</label><div class="tab-content docutils container">
<p>Usually, a Python package installer installs to directories in a
scheme returned by the <code class="docutils literal notranslate"><span class="pre">sysconfig</span></code> standard library package.
Ordinarily, this is the scheme returned by
<code class="docutils literal notranslate"><span class="pre">sysconfig.get_default_scheme()</span></code>, but based on configuration (e.g.
<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--user</span></code>), it may use a different scheme.</p>
<p>Whenever the installer is installing to a <code class="docutils literal notranslate"><span class="pre">sysconfig</span></code> scheme, this
specification declares that the installer should never modify or delete files
outside of that scheme. For instance, if it's upgrading a package, and
the package is already installed in a directory outside that scheme
(perhaps in a directory from another scheme), it should leave the
existing files alone.</p>
<p>If the installer does end up shadowing an existing installation during
an upgrade, we recommend that it produces a warning at the end of its
run.</p>
<p>If the installer is installing to a location outside of a
<code class="docutils literal notranslate"><span class="pre">sysconfig</span></code> scheme (e.g., <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--target</span></code>), then this
subsection does not apply.</p>
</div>
</div>
</section>
<section id="id5">
<h2>发行版建议<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h2>
<p><strong>Recommendations for distros</strong></p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--5-input--1" name="tab-set--5" type="radio"><label class="tab-label" for="tab-set--5-input--1">中文</label><div class="tab-content docutils container">
<p>本节为非规范性章节。它提供了我们认为发行版应遵循的最佳实践，除非有其他特殊原因。</p>
</div>
<input class="tab-input" id="tab-set--5-input--2" name="tab-set--5" type="radio"><label class="tab-label" for="tab-set--5-input--2">英文</label><div class="tab-content docutils container">
<p>This section is non-normative. It provides best practices we believe
distros should follow unless they have a specific reason otherwise.</p>
</div>
</div>
<section id="id6">
<h3>将安装标记为外部管理<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h3>
<p><strong>Mark the installation as externally managed</strong></p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--6-input--1" name="tab-set--6" type="radio"><label class="tab-label" for="tab-set--6-input--1">中文</label><div class="tab-content docutils container">
<p>发行版应在其 <code class="docutils literal notranslate"><span class="pre">stdlib</span></code> 目录中创建一个 <code class="docutils literal notranslate"><span class="pre">EXTERNALLY-MANAGED</span></code> 文件。</p>
</div>
<input class="tab-input" id="tab-set--6-input--2" name="tab-set--6" type="radio"><label class="tab-label" for="tab-set--6-input--2">英文</label><div class="tab-content docutils container">
<p>Distros should create an <code class="docutils literal notranslate"><span class="pre">EXTERNALLY-MANAGED</span></code> file in their <code class="docutils literal notranslate"><span class="pre">stdlib</span></code> directory.</p>
</div>
</div>
</section>
<section id="id7">
<h3>引导用户进入虚拟环境<a class="headerlink" href="#id7" title="Link to this heading">¶</a></h3>
<p><strong>Guide users towards virtual environments</strong></p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--7-input--1" name="tab-set--7" type="radio"><label class="tab-label" for="tab-set--7-input--1">中文</label><div class="tab-content docutils container">
<p>该文件应包含有用且与发行版相关的错误消息，指明如何通过发行版的包管理器安装系统范围的包，并如何设置虚拟环境。如果您的发行版常被用户处于 <code class="docutils literal notranslate"><span class="pre">python3</span></code> 命令可用（尤其是 <code class="docutils literal notranslate"><span class="pre">pip</span></code> 或 <code class="docutils literal notranslate"><span class="pre">get-pip</span></code> 可用）但 <code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">-m</span> <span class="pre">venv</span></code> 无法正常工作的状态，消息应清晰地说明如何正确使 <code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">-m</span> <span class="pre">venv</span></code> 生效。</p>
<p>考虑打包 <code class="docutils literal notranslate"><span class="pre">pipx_</span></code>，这是一个用于安装 Python 语言应用程序的工具，并在错误消息中建议使用它。<code class="docutils literal notranslate"><span class="pre">pipx</span></code> 会为该应用程序单独创建一个虚拟环境，这是一个更好的默认方案，适用于希望安装某些不在发行版中提供的 Python 语言软件，但不打算深入使用 Python 的终端用户。将 <code class="docutils literal notranslate"><span class="pre">pipx</span></code> 打包到发行版中，可以避免用户被告知要执行 <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--user</span> <span class="pre">--break-system-packages</span> <span class="pre">pipx</span></code> 来 <em>避免</em> 损坏系统包的矛盾局面。</p>
<p>考虑安排您的发行版的 Python 环境（例如 Fedora 上的 <code class="docutils literal notranslate"><span class="pre">python3</span></code> 或 Debian 上的 <code class="docutils literal notranslate"><span class="pre">python3-full</span></code>）依赖于 <code class="docutils literal notranslate"><span class="pre">pipx</span></code>。</p>
</div>
<input class="tab-input" id="tab-set--7-input--2" name="tab-set--7" type="radio"><label class="tab-label" for="tab-set--7-input--2">英文</label><div class="tab-content docutils container">
<p>The file should contain a useful and distro-relevant error message
indicating both how to install system-wide packages via the distro's
package manager and how to set up a virtual environment. If your
distro is often used by users in a state where the <code class="docutils literal notranslate"><span class="pre">python3</span></code> command
is available (and especially where <code class="docutils literal notranslate"><span class="pre">pip</span></code> or <code class="docutils literal notranslate"><span class="pre">get-pip</span></code> is
available) but <code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">-m</span> <span class="pre">venv</span></code> does not work, the message should
indicate clearly how to make <code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">-m</span> <span class="pre">venv</span></code> work properly.</p>
<p>Consider packaging <a class="reference external" href="https://github.com/pypa/pipx">pipx</a>, a tool for installing Python-language
applications, and suggesting it in the error. pipx automatically
creates a virtual environment for that application alone, which is a
much better default for end users who want to install some
Python-language software (which isn't available in the distro) but are
not themselves Python users. Packaging pipx in the distro avoids the
irony of instructing users to <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--user</span>
<span class="pre">--break-system-packages</span> <span class="pre">pipx</span></code> to <em>avoid</em> breaking system packages.
Consider arranging things so your distro's package / environment for
Python for end users (e.g., <code class="docutils literal notranslate"><span class="pre">python3</span></code> on Fedora or <code class="docutils literal notranslate"><span class="pre">python3-full</span></code>
on Debian) depends on pipx.</p>
</div>
</div>
</section>
<section id="id8">
<h3>将标记文件保存在容器镜像中<a class="headerlink" href="#id8" title="Link to this heading">¶</a></h3>
<p><strong>Keep the marker file in container images</strong></p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--8-input--1" name="tab-set--8" type="radio"><label class="tab-label" for="tab-set--8-input--1">中文</label><div class="tab-content docutils container">
<p>为单一应用程序容器（例如 Docker 容器镜像）生成官方镜像的发行版，应保留 <code class="docutils literal notranslate"><span class="pre">EXTERNALLY-MANAGED</span></code> 文件，最好以某种方式确保即使用户在该镜像内安装包更新（例如执行 <code class="docutils literal notranslate"><span class="pre">RUN</span> <span class="pre">apt-get</span> <span class="pre">dist-upgrade</span></code>），该文件也不会消失。</p>
</div>
<input class="tab-input" id="tab-set--8-input--2" name="tab-set--8" type="radio"><label class="tab-label" for="tab-set--8-input--2">英文</label><div class="tab-content docutils container">
<p>Distros that produce official images for single-application containers
(e.g., Docker container images) should keep the
<code class="docutils literal notranslate"><span class="pre">EXTERNALLY-MANAGED</span></code> file, preferably in a way that makes it not
go away if a user of that image installs package updates inside
their image (think <code class="docutils literal notranslate"><span class="pre">RUN</span> <span class="pre">apt-get</span> <span class="pre">dist-upgrade</span></code>).</p>
</div>
</div>
</section>
<section id="id9">
<h3>创建单独的发行版和本地目录<a class="headerlink" href="#id9" title="Link to this heading">¶</a></h3>
<p><strong>Create separate distro and local directories</strong></p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--9-input--1" name="tab-set--9" type="radio"><label class="tab-label" for="tab-set--9-input--1">中文</label><div class="tab-content docutils container">
<p>发行版应在系统解释器的 <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> 上设置两个独立的路径，一个用于发行版安装的包，另一个用于本地系统管理员安装的包，并配置 <code class="docutils literal notranslate"><span class="pre">sysconfig.get_default_scheme()</span></code> 指向后者的路径。这确保了像 pip 这样的工具不会修改发行版安装的包。对于本地系统管理员的路径应排在发行版路径之前，以便本地安装的包优先于发行版包。</p>
<p>例如，Fedora 和 Debian（及其衍生版）通过将本地安装的包放在 <code class="docutils literal notranslate"><span class="pre">/usr/local</span></code>，将发行版安装的包放在 <code class="docutils literal notranslate"><span class="pre">/usr</span></code> 来实现这种分离。Fedora 使用 <code class="docutils literal notranslate"><span class="pre">/usr/local/lib/python3.x/site-packages</span></code> 和 <code class="docutils literal notranslate"><span class="pre">/usr/lib/python3.x/site-packages</span></code>。Debian 使用 <code class="docutils literal notranslate"><span class="pre">/usr/local/lib/python3/dist-packages</span></code> 和 <code class="docutils literal notranslate"><span class="pre">/usr/lib/python3/dist-packages</span></code>，并在本地编译的 Python 解释器和发行版的 Python 解释器之间增加了一层分隔：如果你在 <code class="docutils literal notranslate"><span class="pre">/usr/local/bin</span></code> 中构建并安装上游 CPython，它将查看 <code class="docutils literal notranslate"><span class="pre">/usr/local/lib/python3/site-packages</span></code>，而 Debian 想确保通过本地构建的解释器安装的包不会出现在发行版解释器的 <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> 上。</p>
<p>请注意，<code class="docutils literal notranslate"><span class="pre">/usr/local</span></code> 与 <code class="docutils literal notranslate"><span class="pre">/usr</span></code> 的分离类似于 <code class="docutils literal notranslate"><span class="pre">PATH</span></code> 环境变量通常包括 <code class="docutils literal notranslate"><span class="pre">/usr/local/bin:/usr/bin</span></code>，非发行版软件默认安装到 <code class="docutils literal notranslate"><span class="pre">/usr/local</span></code>。这种分离是 <a class="reference external" href="https://refspecs.linuxfoundation.org/FHS_3.0/fhs/ch04s09.html">文件系统层次结构标准</a> 推荐的。</p>
<p>有两种方式可以做到这一点。其一，如果你正在直接构建和打包 Python 库（例如，你的打包工具解包一个 wheel 文件或调用 <code class="docutils literal notranslate"><span class="pre">setup.py</span> <span class="pre">install</span></code>），请安排这些工具使用一个不在 <code class="docutils literal notranslate"><span class="pre">sysconfig</span></code> 方案中的目录，但该目录仍在 <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> 上。</p>
<p>另一种方式是安排在包构建中运行时与在安装系统中运行时的默认 <code class="docutils literal notranslate"><span class="pre">sysconfig</span></code> 方案不同。<a class="reference external" href="https://bugs.python.org/issue43976">bpo-43976</a> 中的 <code class="docutils literal notranslate"><span class="pre">sysconfig</span></code> 自定义钩子应该使这变得简单（当它被接受并实现后）：使你的打包工具设置一个环境变量或其他可检测的配置，并定义一个 <code class="docutils literal notranslate"><span class="pre">get_preferred_schemes</span></code> 函数，在包构建中调用时返回不同的方案。然后，你可以在发行版打包时使用 <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code>。</p>
<p>我们建议为 pip 添加一个 <code class="docutils literal notranslate"><span class="pre">--scheme=...</span></code> 选项，指示 pip 针对特定方案运行。（有关 pip 当前如何确定方案，请参见 <a class="reference internal" href="#implementation-notes">实施说明</a> 。）一旦可用，你就可以在本地测试，甚至在实际打包时，运行类似 <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--scheme=posix_distro</span></code> 以显式将包安装到发行版的路径中（绕过 <code class="docutils literal notranslate"><span class="pre">get_preferred_schemes</span></code>）。如果绝对需要，也可以使用 <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">uninstall</span> <span class="pre">--scheme=posix_distro</span></code> 来使用 pip 从系统管理目录中移除包。</p>
<p>要使用 pip 安装包，你还需要抑制 <code class="docutils literal notranslate"><span class="pre">EXTERNALLY-MANAGED</span></code> 标记文件，以允许 pip 运行，或者在命令行中覆盖它。你可能希望在构建 chroot 环境中和容器镜像中使用相同的方法来抑制标记文件。</p>
<p>自动设置这些（在构建环境中抑制标记文件，并使 <code class="docutils literal notranslate"><span class="pre">get_preferred_schemes</span></code> 自动返回发行版的方案）的好处是，未修改的 <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code> 在包构建中将能正常工作，这通常意味着内部调用 <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code> 的未修改的上游构建脚本会做正确的事。当然，你也可以确保你的打包过程始终调用 <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--scheme=posix_distro</span> <span class="pre">--break-system-packages</span></code>，这也能正常工作。</p>
<p>这里的最佳做法取决于你的发行版的打包约定和机制。</p>
<p>类似地，<code class="docutils literal notranslate"><span class="pre">sysconfig</span></code> 中不用于可导入 Python 代码的路径——即 <code class="docutils literal notranslate"><span class="pre">include</span></code>、<code class="docutils literal notranslate"><span class="pre">platinclude</span></code>、<code class="docutils literal notranslate"><span class="pre">scripts</span></code> 和 <code class="docutils literal notranslate"><span class="pre">data</span></code>——也应具有两种变体，一种供发行版打包的软件使用，另一种供本地安装的软件使用，并且发行版应进行配置，使两者都可以使用。例如，典型的符合 FHS 标准的发行版将使用 <code class="docutils literal notranslate"><span class="pre">/usr/local/include</span></code> 作为默认方案的 <code class="docutils literal notranslate"><span class="pre">include</span></code> 目录，使用 <code class="docutils literal notranslate"><span class="pre">/usr/include</span></code> 作为发行版打包的头文件目录，并将两者都放在编译器的搜索路径中；它将使用 <code class="docutils literal notranslate"><span class="pre">/usr/local/bin</span></code> 作为默认方案的 <code class="docutils literal notranslate"><span class="pre">scripts</span></code> 目录，使用 <code class="docutils literal notranslate"><span class="pre">/usr/bin</span></code> 作为发行版打包的入口点，并将两者都放在 <code class="docutils literal notranslate"><span class="pre">$PATH</span></code> 中。</p>
</div>
<input class="tab-input" id="tab-set--9-input--2" name="tab-set--9" type="radio"><label class="tab-label" for="tab-set--9-input--2">英文</label><div class="tab-content docutils container">
<p>Distros should place two separate paths on the system interpreter's
<code class="docutils literal notranslate"><span class="pre">sys.path</span></code>, one for distro-installed packages and one for packages
installed by the local system administrator, and configure
<code class="docutils literal notranslate"><span class="pre">sysconfig.get_default_scheme()</span></code> to point at the latter path. This
ensures that tools like pip will not modify distro-installed packages.
The path for the local system administrator should come before the
distro path on <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> so that local installs take preference
over distro packages.</p>
<p>For example, Fedora and Debian (and their derivatives) both implement
this split by using <code class="docutils literal notranslate"><span class="pre">/usr/local</span></code> for locally-installed packages and
<code class="docutils literal notranslate"><span class="pre">/usr</span></code> for distro-installed packages. Fedora uses
<code class="docutils literal notranslate"><span class="pre">/usr/local/lib/python3.x/site-packages</span></code> vs.
<code class="docutils literal notranslate"><span class="pre">/usr/lib/python3.x/site-packages</span></code>. (Debian uses
<code class="docutils literal notranslate"><span class="pre">/usr/local/lib/python3/dist-packages</span></code> vs.
<code class="docutils literal notranslate"><span class="pre">/usr/lib/python3/dist-packages</span></code> as an additional layer of
separation from a locally-compiled Python interpreter: if you build
and install upstream CPython in <code class="docutils literal notranslate"><span class="pre">/usr/local/bin</span></code>, it will look at
<code class="docutils literal notranslate"><span class="pre">/usr/local/lib/python3/site-packages</span></code>, and Debian wishes to make
sure that packages installed via the locally-built interpreter don't
show up on <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> for the distro interpreter.)</p>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">/usr/local</span></code> vs. <code class="docutils literal notranslate"><span class="pre">/usr</span></code> split is analogous to how
the <code class="docutils literal notranslate"><span class="pre">PATH</span></code> environment variable typically includes
<code class="docutils literal notranslate"><span class="pre">/usr/local/bin:/usr/bin</span></code> and non-distro software installs to
<code class="docutils literal notranslate"><span class="pre">/usr/local</span></code> by default. This split is <a class="reference external" href="https://refspecs.linuxfoundation.org/FHS_3.0/fhs/ch04s09.html">recommended by the
Filesystem Hierarchy Standard</a>.</p>
<p>There are two ways you could do this. One is, if you are building and
packaging Python libraries directly (e.g., your packaging helpers
unpack a wheel or call <code class="docutils literal notranslate"><span class="pre">setup.py</span> <span class="pre">install</span></code>), arrange
for those tools to use a directory that is not in a <code class="docutils literal notranslate"><span class="pre">sysconfig</span></code>
scheme but is still on <code class="docutils literal notranslate"><span class="pre">sys.path</span></code>.</p>
<p>The other is to arrange for the default <code class="docutils literal notranslate"><span class="pre">sysconfig</span></code> scheme to change
when running inside a package build versus when running on an
installed system. The <code class="docutils literal notranslate"><span class="pre">sysconfig</span></code> customization hooks from
<a class="reference external" href="https://bugs.python.org/issue43976">bpo-43976</a> should make this easy (once accepted and implemented):
make your packaging tool set an
environment variable or some other detectable configuration, and
define a <code class="docutils literal notranslate"><span class="pre">get_preferred_schemes</span></code> function to return a different
scheme when called from inside a package build. Then you can use <code class="docutils literal notranslate"><span class="pre">pip</span>
<span class="pre">install</span></code> as part of your distro packaging.</p>
<p>We propose adding a <code class="docutils literal notranslate"><span class="pre">--scheme=...</span></code> option to instruct pip to run
against a specific scheme. (See <a class="reference internal" href="#implementation-notes">Implementation Notes</a> below for how
pip currently determines schemes.) Once that's available, for local
testing and possibly for actual packaging, you would be able to run
something like <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--scheme=posix_distro</span></code> to explicitly
install a package into your distro's location (bypassing
<code class="docutils literal notranslate"><span class="pre">get_preferred_schemes</span></code>). One could also, if absolutely needed, use
<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">uninstall</span> <span class="pre">--scheme=posix_distro</span></code> to use pip to remove packages
from the system-managed directory.</p>
<p>To install packages with pip, you would also need to either suppress
the <code class="docutils literal notranslate"><span class="pre">EXTERNALLY-MANAGED</span></code> marker file to allow pip to run or to
override it on the command line. You may want to use the same means
for suppressing the marker file in build chroots as you do in
container images.</p>
<p>The advantage of setting these up to be automatic (suppressing the
marker file in your build environment and having
<code class="docutils literal notranslate"><span class="pre">get_preferred_schemes</span></code> automatically return your distro's scheme)
is that an unadorned <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code> will work inside a package build,
which generally means that an unmodified upstream build script that
happens to internally call <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code> will do the right thing.
You can, of course, just ensure that your packaging process always
calls <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--scheme=posix_distro</span> <span class="pre">--break-system-packages</span></code>,
which would work too.</p>
<p>The best approach here depends a lot on your distro's conventions and
mechanisms for packaging.</p>
<p>Similarly, the <code class="docutils literal notranslate"><span class="pre">sysconfig</span></code> paths that are not for importable Python
code - that is, <code class="docutils literal notranslate"><span class="pre">include</span></code>, <code class="docutils literal notranslate"><span class="pre">platinclude</span></code>, <code class="docutils literal notranslate"><span class="pre">scripts</span></code>, and
<code class="docutils literal notranslate"><span class="pre">data</span></code> - should also have two variants, one for use by
distro-packaged software and one for use for locally-installed
software, and the distro should be set up such that both are usable.
For instance, a typical FHS-compliant distro will use
<code class="docutils literal notranslate"><span class="pre">/usr/local/include</span></code> for the default scheme's <code class="docutils literal notranslate"><span class="pre">include</span></code> and
<code class="docutils literal notranslate"><span class="pre">/usr/include</span></code> for distro-packaged headers and place both on the
compiler's search path, and it will use <code class="docutils literal notranslate"><span class="pre">/usr/local/bin</span></code> for the
default scheme's <code class="docutils literal notranslate"><span class="pre">scripts</span></code> and <code class="docutils literal notranslate"><span class="pre">/usr/bin</span></code> for distro-packaged
entry points and place both on <code class="docutils literal notranslate"><span class="pre">$PATH</span></code>.</p>
</div>
</div>
</section>
</section>
<section id="implementation-notes">
<span id="id11"></span><h2>实施说明<a class="headerlink" href="#implementation-notes" title="Link to this heading">¶</a></h2>
<p><strong>Implementation Notes</strong></p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--10-input--1" name="tab-set--10" type="radio"><label class="tab-label" for="tab-set--10-input--1">中文</label><div class="tab-content docutils container">
<p>本节是非规范性的，包含与规范和潜在实现相关的注释。</p>
<p>目前（截至 2021 年 5 月），pip 并没有直接提供选择目标 <code class="docutils literal notranslate"><span class="pre">sysconfig</span></code> 方案的方法，但它有三种查找方案的方式：</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code></dt><dd><p>调用 <code class="docutils literal notranslate"><span class="pre">sysconfig.get_default_scheme()</span></code>，通常（在上游 CPython 和大多数当前的发行版中）这与 <code class="docutils literal notranslate"><span class="pre">get_preferred_scheme('prefix')</span></code> 相同。</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--prefix=/some/path</span></code></dt><dd><p>调用 <code class="docutils literal notranslate"><span class="pre">sysconfig.get_preferred_scheme('prefix')</span></code>。</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--user</span></code></dt><dd><p>调用 <code class="docutils literal notranslate"><span class="pre">sysconfig.get_preferred_scheme('user')</span></code>。</p>
</dd>
</dl>
<p>最后，<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--target=/some/path</span></code> 直接写入 <code class="docutils literal notranslate"><span class="pre">/some/path</span></code>，不查找任何方案。</p>
<p>Debian 当前携带了一个 <a class="reference external" href="https://sources.debian.org/src/python3.7/3.7.3-2+deb10u3/debian/patches/distutils-install-layout.diff/">补丁以更改虚拟环境中的默认安装位置</a>，通过一些启发式方法（包括检查 <code class="docutils literal notranslate"><span class="pre">VIRTUAL_ENV</span></code> 环境变量），主要是为了确保虚拟环境中的目录保持为 <code class="docutils literal notranslate"><span class="pre">site-packages</span></code> 而不是 <code class="docutils literal notranslate"><span class="pre">dist-packages</span></code>。这对本提案没有特别影响，因为该补丁的实现并未真正更改默认的 <code class="docutils literal notranslate"><span class="pre">sysconfig</span></code> 方案，特别是并没有更改 <code class="docutils literal notranslate"><span class="pre">sysconfig.get_path(&quot;stdlib&quot;)</span></code> 的结果。</p>
<p>Fedora 当前携带了一个 <a class="reference external" href="https://src.fedoraproject.org/rpms/python3.9/blob/f34/f/00251-change-user-install-location.patch">补丁以更改非 rpmbuild 环境中的默认安装位置</a>，它们用于实现两个系统范围目录的方法。这在概念上与 <a class="reference external" href="https://bugs.python.org/issue43976">bpo-43976</a> 中设想的钩子类似，除了它是作为代码补丁应用到 <code class="docutils literal notranslate"><span class="pre">distutils</span></code> 中，而不是作为更改的 <code class="docutils literal notranslate"><span class="pre">sysconfig</span></code> 方案。</p>
<p>上文中实现的 <code class="docutils literal notranslate"><span class="pre">is_virtual_environment</span></code> 逻辑，以及加载 <code class="docutils literal notranslate"><span class="pre">EXTERNALLY-MANAGED</span></code> 文件并从中查找错误消息的逻辑，可以添加到标准库（分别是 <code class="docutils literal notranslate"><span class="pre">sys</span></code> 和 <code class="docutils literal notranslate"><span class="pre">sysconfig</span></code> 中），以集中管理这些实现，但目前不需要立即添加。</p>
</div>
<input class="tab-input" id="tab-set--10-input--2" name="tab-set--10" type="radio"><label class="tab-label" for="tab-set--10-input--2">英文</label><div class="tab-content docutils container">
<p>This section is non-normative and contains notes relevant to both the
specification and potential implementations.</p>
<p>Currently (as of May 2021), pip does not directly expose a way to choose
a target <code class="docutils literal notranslate"><span class="pre">sysconfig</span></code> scheme, but it has three ways of looking up schemes
when installing:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code></dt><dd><p>Calls <code class="docutils literal notranslate"><span class="pre">sysconfig.get_default_scheme()</span></code>, which is usually (in
upstream CPython and most current distros) the same as
<code class="docutils literal notranslate"><span class="pre">get_preferred_scheme('prefix')</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--prefix=/some/path</span></code></dt><dd><p>Calls <code class="docutils literal notranslate"><span class="pre">sysconfig.get_preferred_scheme('prefix')</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--user</span></code></dt><dd><p>Calls <code class="docutils literal notranslate"><span class="pre">sysconfig.get_preferred_scheme('user')</span></code>.</p>
</dd>
</dl>
<p>Finally, <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--target=/some/path</span></code> writes directly to
<code class="docutils literal notranslate"><span class="pre">/some/path</span></code> without looking up any schemes.</p>
<p>Debian currently carries a <a href="#id14"><span class="problematic" id="id15">`patch to change the default install
location inside a virtual environment`__</span></a>, using a few heuristics
(including checking for the <code class="docutils literal notranslate"><span class="pre">VIRTUAL_ENV</span></code> environment variable),
largely so that the directory used in a virtual environment remains
<code class="docutils literal notranslate"><span class="pre">site-packages</span></code> and not <code class="docutils literal notranslate"><span class="pre">dist-packages</span></code>. This does not
particularly affect this proposal, because the implementation of that
patch does not actually change the default <code class="docutils literal notranslate"><span class="pre">sysconfig</span></code> scheme, and
notably does not change the result of
<code class="docutils literal notranslate"><span class="pre">sysconfig.get_path(&quot;stdlib&quot;)</span></code>.</p>
<p>Fedora currently carries a <a href="#id14"><span class="problematic" id="id16">`patch to change the default install
location when not running inside rpmbuild`__</span></a>, which they use to
implement the two-system-wide-directories approach. This is
conceptually the sort of hook envisioned by <a class="reference external" href="https://bugs.python.org/issue43976">bpo-43976</a>, except
implemented as a code patch to <code class="docutils literal notranslate"><span class="pre">distutils</span></code> instead of as a changed
<code class="docutils literal notranslate"><span class="pre">sysconfig</span></code> scheme.</p>
<p>The implementation of <code class="docutils literal notranslate"><span class="pre">is_virtual_environment</span></code> above, as well as the
logic to load the <code class="docutils literal notranslate"><span class="pre">EXTERNALLY-MANAGED</span></code> file and find the error
message from it, may as well get added to the standard library
(<code class="docutils literal notranslate"><span class="pre">sys</span></code> and <code class="docutils literal notranslate"><span class="pre">sysconfig</span></code>, respectively), to centralize their
implementations, but they don't need to be added yet.</p>
</div>
</div>
</section>
<section id="id12">
<h2>版权<a class="headerlink" href="#id12" title="Link to this heading">¶</a></h2>
<p><strong>Copyright</strong></p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--11-input--1" name="tab-set--11" type="radio"><label class="tab-label" for="tab-set--11-input--1">中文</label><div class="tab-content docutils container">
<p>本文档属于公共领域或 CC0-1.0-Universal 许可证（以更宽松的为准）。</p>
</div>
<input class="tab-input" id="tab-set--11-input--2" name="tab-set--11" type="radio"><label class="tab-label" for="tab-set--11-input--2">英文</label><div class="tab-content docutils container">
<p>This document is placed in the public domain or under the CC0-1.0-Universal license, whichever is more permissive.</p>
</div>
</div>
</section>
<section id="id13">
<h2>历史<a class="headerlink" href="#id13" title="Link to this heading">¶</a></h2>
<p><strong>History</strong></p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--12-input--1" name="tab-set--12" type="radio"><label class="tab-label" for="tab-set--12-input--1">中文</label><div class="tab-content docutils container">
<ul class="simple">
<li><p>2022 年 6 月：该规范已通过 <span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0668/"><strong>PEP 668</strong></a> 批准。</p></li>
</ul>
</div>
<input class="tab-input" id="tab-set--12-input--2" name="tab-set--12" type="radio"><label class="tab-label" for="tab-set--12-input--2">英文</label><div class="tab-content docutils container">
<ul class="simple">
<li><p>June 2022: This specification was approved through <span class="target" id="index-1"></span><a class="pep reference external" href="https://peps.python.org/pep-0668/"><strong>PEP 668</strong></a>.</p></li>
</ul>
</div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="section-distribution-formats.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">包分发文件格式</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="virtual-environments.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Python 虚拟环境</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2013–2020, PyPA
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on 2024 年 11 月 15 日</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">外部管理环境</a><ul>
<li><a class="reference internal" href="#id2">术语</a></li>
<li><a class="reference internal" href="#id3">概述</a></li>
<li><a class="reference internal" href="#id4">将解释器标记为使用外部包管理器</a></li>
<li><a class="reference internal" href="#sysconfig">仅写入目标“sysconfig”方案</a></li>
<li><a class="reference internal" href="#id5">发行版建议</a><ul>
<li><a class="reference internal" href="#id6">将安装标记为外部管理</a></li>
<li><a class="reference internal" href="#id7">引导用户进入虚拟环境</a></li>
<li><a class="reference internal" href="#id8">将标记文件保存在容器镜像中</a></li>
<li><a class="reference internal" href="#id9">创建单独的发行版和本地目录</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementation-notes">实施说明</a></li>
<li><a class="reference internal" href="#id12">版权</a></li>
<li><a class="reference internal" href="#id13">历史</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=7d86a446"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/tabs.js?v=3ee01567"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=cb5fb026"></script>
    <script src="../_static/translations.js?v=beaddf03"></script>
    </body>
</html>